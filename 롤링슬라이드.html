<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>롤링슬라이드</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    ul,
    li {
      list-style: none;
    }

    h1 {
      text-align: center;
    }

    #banner_wrap {
      width: 260px;
      padding: 10px 20px;
      margin: auto;
      border: 1px solid #aaa;
    }

    #banner {
      width: 800px;
      height: 54px;
      /* border: 1px solid red; */
      display: flex;
      gap: 8px;
    }

    #frame {
      width: 232px;
      height: 54px;
      position: relative;
      margin: 10px auto;
      border: 1px solid blue;
      overflow: hidden;
    }
  </style>
</head>

<body>
  <h1>롤링 슬라이드 배너 만들기</h1>
  <div id="banner_wrap">
    <div id="frame">
      <ul id="banner">
        <li><a href="#"><img src="img/pic_t1.jpg"></a></li>
        <li><a href="#"><img src="img/pic_t2.jpg"></a></li>
        <li><a href="#"><img src="img/pic_t3.jpg"></a></li>
        <li><a href="#"><img src="img/pic_t4.jpg"></a></li>
        <li><a href="#"><img src="img/pic_t5.jpg"></a></li>
      </ul>
    </div>
    <p>
      <a href="#" class="prev">
        <img src="img/prev_btn.png" alt="이전 버튼">
      </a>
      <a href="#" class="next">
        <img src="img/next_btn.png" alt="다음 버튼">
      </a>
    </p>
  </div>
  <script>
    addEventListener("load", () => {
      const list = document.querySelector("#banner");
      const listLi = document.querySelectorAll("#banner li");

      const show_num = 3; //한번에 보여줄 슬라이드 수
      const total = listLi.length; //전체 슬라이드의 갯수
      //첫번째 li의 넓이를 저장 (정수로 반환) + 8(여백)
      const li_wd = parseInt(getComputedStyle(listLi[0]).width) + 8;
      //console.log(li_wd)
      let eventhandler = true; //이벤트 제어

      //무한 스크롤 하기 위해 3개의 슬라이드를 복사하여 추가
      for(let i = 0; i < show_num; i++){
        //cloneNode() = 요소를 복제하는 메서드
        const copyobj = listLi[i].cloneNode(true);
        //list의 마지막 자손위치로 추가
        list.appendChild(copyobj);
      }

      let num = 0; //현재 슬라이드 번호를 관리하는 변수

      //슬라이드를 자동으로 전환하는 기능을 수행
      function autoplay(){
        //num이 전체 슬라이드 수(5)에 도달하면 num울 0으로 초기화
        if(num === total){
          num = 0;
          list.style.transition = "none";//transition 제거
          list.style.marginLeft = "0px";//marginLeft를 초기화
        }
        //함수를 0.05초 후에 실행
        setTimeout(function(){
          num++;//num을 1증가하고
          list.style.transition = "margin-left .5s"//transition을 적용
          list.style.marginLeft = `${-li_wd*num}px`//#banner의 marginLeft값을 li요소이 넓이 * num으로 적용 이따 -를 붙여서 왼쪽으로 이동시킴
        },50)
      }

      //슬라이드 자동 실행
      let timer = setInterval(autoplay, 3000);

      //mouseover시 정지
      const banner_wrap = document.querySelector("#banner_wrap");
      banner_wrap.addEventListener("mouseover", () => {
        clearInterval(timer)
      });
      // mouseout시 재개
      banner_wrap.addEventListener("mouseout", () => {
        timer = setInterval(autoplay, 3000);
      });


      //next버튼에 클릭 이벤트를 생성
      document.querySelector(".next").addEventListener("click", (e) => {
        e.preventDefault();
        if(eventhandler){//eventhandler가 true일때 실행
          eventhandler = false; //false로 변경하여 슬라이드 중에 이벤트가 중첩으로 실행되는 것을 막아줌
          if(num === total){
            num = 0;
            list.style.transition = "none";
            list.style.marginLeft = "0px";
          }
          setTimeout(function(){
            num++;
            list.style.transition = "margin-left .5s";
            list.style.marginLeft = `${-li_wd*num}px`;
            //0.5초뒤에 (애니메이션이 끝난 후에)eventhandler를 true로 변경하여 기능이 다시 실행되도록
            setTimeout(function(){
              eventhandler = true;
            },500);
          },50);
        }
      })
      //prev버튼에 클릭 이벤트를 생성
      document.querySelector(".prev").addEventListener("click", (e) => {
        e.preventDefault();
        if(eventhandler){//eventhandler가 true일때 실행
          eventhandler = false; //false로 변경하여 슬라이드 중에 이벤트가 중첩으로 실행되는 것을 막아줌
          if(num === 0){
            num = total;//num이 마지막 슬라이드 순번값으로 적용
            list.style.transition = "none";
            list.style.marginLeft = `${-li_wd*num}px`;//마지막 위치로 marginLeft값을 변경하여 이동시킴
          }
          setTimeout(function(){
            num--;//num값 1감소
            list.style.transition = "margin-left .5s";
            list.style.marginLeft = `${-li_wd*num}px`;
            //0.5초뒤에 (애니메이션이 끝난 후에)eventhandler를 true로 변경하여 기능이 다시 실행되도록
            setTimeout(function(){
              eventhandler = true;
            },500);
          },50);
        }
      })
    })
  </script>
</body>

</html>